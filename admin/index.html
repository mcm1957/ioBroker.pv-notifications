<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pv-notifications</title>
    <script type="text/javascript" src="../../lib/js/jquery-3.x.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../js/adapter-settings.js"></script>
    <script>
        // Поля для selectID
        const selectFields = [
            'batterySOC', 'powerProduction', 'totalProduction', 'feedIn',
            'consumption', 'gridPower', 'weeklyProduction', 'weeklyConsumption',
            'weeklyFeedIn', 'weeklyGridPower', 'monthlyProduction', 'monthlyConsumption',
            'monthlyFeedIn', 'monthlyGridPower', 'weatherTodayText', 'weatherTodayTemp',
            'weatherTomorrowText', 'weatherTomorrowTemp'
        ];

        function load(settings, onChange) {
            if (!settings) return;

            // Инициализация selectID для полей
            selectFields.forEach(function (id) {
                const $input = $('#' + id);
                if ($input.length) {
                    $input.selectID('init', {
                        noSelect: true,
                        value: settings[id],
                        onChange: function () {
                            onChange();
                        }
                    });
                }
            });

            // Обработчики изменений
            $('.value').on('change', function () {
                onChange();
            });

            // Заполнение значений
            $('.value').each(function () {
                var $this = $(this);
                var id = $this.attr('id');
                if (settings[id] !== undefined) {
                    if ($this.attr('type') === 'checkbox') {
                        $this.prop('checked', settings[id]);
                    } else {
                        $this.val(settings[id]);
                    }
                }
            });

            // Обновление Materialize
            setTimeout(function() {
                M.updateTextFields();
                $('select').each(function() {
                    $(this).trigger('change');
                });
            }, 100);
        }

        function save(callback) {
            var settings = {};
            $('.value').each(function () {
                var $this = $(this);
                var id = $this.attr('id');
                if ($this.attr('type') === 'checkbox') {
                    settings[id] = $this.prop('checked');
                } else {
                    settings[id] = $this.val();
                }
            });
            callback(settings);
        }
    </script>
</head>
<body>
    <div id="adapter-container"></div>
    <script src="jsonConfig.js"></script>
</body>
</html>
